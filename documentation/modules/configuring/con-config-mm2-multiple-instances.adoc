:_mod-docs-content-type: CONCEPT

// Module included in the following assemblies:
//
// assembly-config.adoc

[id='con-config-mm2-multiple-instances-{context}']
= Configuring MirrorMaker 2 using a shared target Kafka cluster

[role="_abstract"]
MirrorMaker 2 runs on the Kafka Connect framework and uses internal Kafka topics to store configuration, offsets, and status information.
When running multiple MirrorMaker 2 instances that share the same target Kafka cluster, you must configure unique Kafka Connect worker settings so that each instance operates independently.

Kafka Connect identifies a worker cluster by its group ID and by the names of the internal topics it uses.
If multiple MirrorMaker 2 instances use the same values, they form a single Kafka Connect cluster and share internal state.

When deploying multiple MirrorMaker 2 instances against the same target Kafka cluster, configure unique values for the following Kafka Connect worker properties in each Kafka Connect deployment:

* `group.id`
* `config.storage.topic`
* `offset.storage.topic`
* `status.storage.topic`

These settings are configured in the `.spec.target` section. 

[source,yaml,subs="attributes+"]
----
apiVersion: {KafkaMirrorMaker2ApiVersion}
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  # Target / Connect cluster configuration (required)
  target:
    alias: "my-cluster-target"
    bootstrapServers: my-cluster-target-kafka-bootstrap:9092
    groupId: my-mirror-maker2-group # <1>
    configStorageTopic: my-mirror-maker2-config # <2>
    offsetStorageTopic: my-mirror-maker2-offset # <3>
    statusStorageTopic: my-mirror-maker2-status # <4>
  # ...
----
<1> The Kafka Connect cluster group ID within Kafka.
<2> Kafka topic that stores connector offsets.
<3> Kafka topic that stores connector and task status configurations.
<4> Kafka topic that stores connector and task status updates.

NOTE: All workers that belong to the same Kafka Connect cluster must use the same values for these properties.

If multiple MirrorMaker 2 instances are deployed with the same worker group ID and internal topic names, they form a single Kafka Connect cluster and share internal topics.
This can result in unexpected behavior and replication errors.

You do not need to change these settings when:

* Multiple MirrorMaker 2 instances use the same source Kafka cluster but different target Kafka clusters.
* Deploying active-active replication, where each MirrorMaker 2 instance uses a different target Kafka cluster.
